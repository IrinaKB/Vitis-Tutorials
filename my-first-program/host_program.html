


<!DOCTYPE HTML>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
	<head>
		<meta charset="utf-8">
		
		<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
		<link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.4382/css/CoveoFullSearch.css"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="description"/>
		<meta name="keywords"/>
		<meta property="og:title" content=""/>
		<meta property="og:description"/>
		<!-- favicon -->
		<link rel="icon" type="image/vnd.microsoft.icon" href="../_static/favicon.ico"/>
		<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="../_static/favicon.ico"/>
		<!-- Fonts -->
		<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet" type="text/css"/>

  
  
  
  

  
      <script type="text/javascript" src="../_static/js/jquery.min.js"></script>	
	  <script type="text/javascript" src="../_static/js/gtm.js"></script>
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
    <script type="text/javascript" src="../_static/js/d3dd8c60ed.js"></script>
    <script type="text/javascript" src="../_static/js/common-ui-all.min.js"></script>		
    <script type="text/javascript" src="../_static/js/header-footer.min.js"></script>	
    <script type="text/javascript" src="../_static/js/jquery-ui.min.js"></script>	
    <script type="text/javascript" src="../_static/js/CoveoJsSearch.Lazy.min.js"></script>	
    <script type="text/javascript" src="../_static/js/linkid.js"></script>		
    <script type="text/javascript" src="../_static/js/Searchbox.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/common-ui-all.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/header-footer.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/pro.min.css" media="all" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
	</head>
	<body>
		<div class="xilinx-bs3"/>
		<div class="root responsivegrid">
			<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 aem-Grid--large--16 aem-Grid--xlarge--16 aem-Grid--xxlarge--16 aem-Grid--xxxlarge--16 ">
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn aem-GridColumn--default--12">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="header parbase aem-GridColumn aem-GridColumn--default--12">
								<noindex>
									<header data-component="header">
										<nav class="navbar navbar-default aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid main-nav">
													<div class="row">
														<div class="col-xs-12">
															<div class="logo-column">
																<div class="logo">
																	<a href="https://www.xilinx.com/">
																	<img src="https://www.xilinx.com/etc.clientlibs/site/clientlibs/xilinx/all/resources/imgs/header/xilinx-header-logo.svg" title="Xilinx Inc"/>
																	</a>
																</div>
															</div>
															<div class="navbar-column">
																<div class="navbar navbar-collapse collapse" id="xilinx-main-menu">
																	<div class="mobile-search-container">
																		<div id="headerSearchBox" class="headerSearch"
																			data-component="header-search" 
																			data-redirect-if-empty="false"
																			data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																			data-coveo-organization-id="xilinxcomprode2rjoqok">
																			<div class='coveo-search-section'>
																				<div class="CoveoAnalytics" data-search-hub="Site"></div>
																				<ul class="dropdown-menu options">
																					<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																						<a href="#">
																						All</a>
																					</li>
																					<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com//products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Silicon Devices</a>
																					</li>
																					<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com//products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Boards and Kits</a>
																					</li>
																					<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com//products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Intellectual Property</a>
																					</li>
																					<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																						<a href="#">
																						Support</a>
																						<ul>
																							<li data-label="Documentation" data-action-link="https://www.xilinx.com//support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																								<a href="#">
																								Documentation</a>
																							</li>
																							<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com//support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																								<a href="#">
																								Knowledge Base</a>
																							</li>
																							<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																								<a href="#">
																								Community Forums</a>
																							</li>
																						</ul>
																					</li>
																					<li data-label="Partners" data-action-link="https://www.xilinx.com//alliance/member-keyword-search.html" data-search-hub="Partner">
																						<a href="#">
																						Partners</a>
																					</li>
																					<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																						<a href="#">
																						Videos</a>
																					</li>
																					<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																						<a href="#">
																						Press</a>
																					</li>
																				</ul>
																				<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																				<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																			</div>
																		</div>
																	</div>
																	<ul class="nav navbar-nav nav-justified">
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/applications.html">
																			Applications</a> 
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/products/silicon-devices.html">
																			Products</a> 
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://developer.xilinx.com/">
																			Developers</a> 
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/support.html">
																			Support</a> 
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/about/company-overview.html">
																			About</a> 
																		</li>
																	</ul>
																</div>
															</div>
															<script type="text/javascript" src="../_static/js/gtm.js"></script>
															<!--<div class="mini-nav">
																<button type="button" data-function="xilinx-mobile-menu" id="nav-toggle" class="navbar-toggle collapsed visible-xs-block" aria-expanded="false">
																<span></span>
																<span></span>
																<span></span>
																<span></span>
																</button>
																<ul class="list-inline">
																	<li class="dropdown user-menu">
																		<button data-toggle="dropdown">
																		<span class="sr-only">Account</span>
																		<span class="fas fa-user"></span>
																		</button>
																		<ul class="dropdown-menu">
																			<li>
																				<a href="https://www.xilinx.com/myprofile/subscriptions.html">
																				My Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/registration/create-account.html">
																				Create Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/bin/protected/en/signout">
																				Sign Out</a>
																			</li>
																		</ul>
																	</li>
																	<li class="hidden-xs">
																		<button data-function="search-toggle">
																		<span class="sr-only">Search</span>
																		<span class="far fa-search"></span>
																		</button>
																	</li>
																</ul>
															</div>
															-->
															<div class="search-container">
																<div id="headerSearchBox" class="headerSearch"
																	data-component="header-search" 
																	data-redirect-if-empty="false"
																	data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																	data-coveo-organization-id="xilinxcomprode2rjoqok">
																	<div class='coveo-search-section'>
																		<div class="CoveoAnalytics" data-search-hub="Site"></div>
																		<ul class="dropdown-menu options">
																			<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																				<a href="#">
																				All</a>
																			</li>
																			<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com/products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Silicon Devices</a>
																			</li>
																			<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com/products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Boards and Kits</a>
																			</li>
																			<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com/products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Intellectual Property</a>
																			</li>
																			<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																				<a href="#">
																				Support</a>
																				<ul>
																					<li data-label="Documentation" data-action-link="https://www.xilinx.com/support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																						<a href="#">
																						Documentation</a>
																					</li>
																					<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com/support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																						<a href="#">
																						Knowledge Base</a>
																					</li>
																					<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																						<a href="#">
																						Community Forums</a>
																					</li>
																				</ul>
																			</li>
																			<li data-label="Partners" data-action-link="https://www.xilinx.com/alliance/member-keyword-search.html" data-search-hub="Partner">
																				<a href="#">
																				Partners</a>
																			</li>
																			<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																				<a href="#">
																				Videos</a>
																			</li>
																			<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																				<a href="#">
																				Press</a>
																			</li>
																		</ul>
																		<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																		<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																	</div>
																</div>
																<button data-function="search-toggle">
																<span class="sr-only">Search</span>
																<span class="far fa-times"></span>
																</button>
															</div>
														</div>
													</div>
												</div>
											</div>
										</nav>
									</header>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="parsys aem-GridColumn--xxxlarge--none aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
						<div class="container-fluid">
							<div class="row">
							<div class="col-xs-12">
   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../README.html" class="icon icon-home" alt="Documentation Home"> Vitis™ Application Acceleration Development Flow Tutorials
          

          
          </a>

          
            
            
              <div class="version">
                2020.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started Pathway</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../vitis-getting-started/README.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vitis-execution-model/README.html">Execution Model of an FPGA Accelerated Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../alveo-getting-started/README.html">Getting Started with the Alveo Portfolio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Pathway3/README.html">Essential Concepts for Building and Running the Accelerated Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="README.html">My First Program</a></li>
<li class="toctree-l1"><a class="reference internal" href="../convolution-tutorial/README.html">Optimizing Accelerated FPGA Applications: Convolution Example</a></li>
</ul>
<p class="caption"><span class="caption-text">Intermediate</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting-started-rtl-kernels/README.html">Getting Started with RTL Kernels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vitis_hls_analysis/README.html">Vitis HLS Analysis and Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mixing-c-rtl-kernels/README.html">Mixing C++ and RTL Kernels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using-multiple-cu/README.html">Using Multiple Compute Units</a></li>
<li class="toctree-l1"><a class="reference internal" href="../host-code-opt/README.html">Host Code Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mult-ddr-banks/README.html">Using Multiple DDR Banks</a></li>
</ul>
<p class="caption"><span class="caption-text">Advanced</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../controlling-vivado-impl/README.html">Controlling Vivado Implementation</a></li>
</ul>
<p class="caption"><span class="caption-text">Versions</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://xilinx.github.io/Vitis-Tutorials/2020-1/docs/README.html">Master</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/Xilinx/Vitis-Tutorials/blob/master/README.md">2019.2</a></li>
</ul>

            
			
			<p class="caption"><span class="caption-text">This Page</span></p>
				<ul class="current">
				  <li class="toctree-l1"><a href="../_sources/my-first-program/host_program.md.txt"
						rel="nofollow">Show Source</a></li>						
				</ul>
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../README.html">Vitis™ Application Acceleration Development Flow Tutorials</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../README.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>2. Coding My First Host Program</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/my-first-program/host_program.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <table class="sphinxhide">
 <tr>
   <td align="center"><img src="https://www.xilinx.com/content/dam/xilinx/imgs/press/media-kits/corporate/xilinx-logo.png" width="30%"/><h1>2020.1 Vitis™ Application Acceleration Development Flow Tutorials</h1>
   <a href="https://github.com/Xilinx/Vitis-Tutorials/branches/all">See 2019.2 Vitis Application Acceleration Development Flow Tutorials</a>
   </td>
 </tr>
 <tr>
 <td>
 </td>
 </tr>
</table><div class="section" id="coding-my-first-host-program">
<h1>2. Coding My First Host Program<a class="headerlink" href="#coding-my-first-host-program" title="Permalink to this headline">¶</a></h1>
<p>After coding the kernel, you will now learn about the host application. The host application is written in either C or C++ using OpenCL APIs calls to interact with the FPGA accelerators.</p>
<p>An example host code is provided in the <code class="docutils literal notranslate"><span class="pre">./reference-files/src</span></code> folder, which shows both the C++ version and the C version. In this tutorial, you will only be looking at the C++ version.</p>
<ul class="simple">
<li><p>The C++ version of the host code can be found in the <code class="docutils literal notranslate"><span class="pre">host.cpp</span></code> file.</p></li>
<li><p>The C version of the host code can be found in the <code class="docutils literal notranslate"><span class="pre">host.c</span></code> file.</p></li>
</ul>
<p>In general, you can divide the structure of the host application into three sections:</p>
<ol class="simple">
<li><p>Setting up the hardware.</p></li>
<li><p>Executing the kernels.</p></li>
<li><p>Releasing the hardware resources after the kernel returns.</p></li>
</ol>
<p>As you go through this tutorial, you will be looking at each step individually.</p>
<div class="section" id="setting-up-the-hardware">
<h2>Setting up the Hardware<a class="headerlink" href="#setting-up-the-hardware" title="Permalink to this headline">¶</a></h2>
<p>The application must start by setting up and initializing the FPGA. This typically involves the following steps:</p>
<ul class="simple">
<li><p>Retrieving the list of available Xilinx platforms.</p></li>
<li><p>Retrieving the list of devices supported by each Xilinx platform.</p></li>
<li><p>Creating a context.</p></li>
<li><p>Creating a program object from the pre-compiled FPGA binary (<code class="docutils literal notranslate"><span class="pre">xclbin</span></code>).</p></li>
<li><p>Creating a kernel object.</p></li>
</ul>
<p>As you work through this section, refer to step 1 in the <code class="docutils literal notranslate"><span class="pre">host.cpp</span></code> file.</p>
<blockquote>
<div><p><strong>TIP:</strong> This lab references the C++ code, but C code is also provided in the reference files. For more information on specific OpenCL API calls listed here, refer to the <a class="reference external" href="https://www.khronos.org/registry/OpenCL/sdk/1.2/docs/man/xhtml/">OpenCL Reference Pages</a>.</p>
</div></blockquote>
<ol>
<li><p>The application should start by identifying the platforms composed of Xilinx FPGA devices. To identify the presence of Xilinx platforms, you should use the <code class="docutils literal notranslate"><span class="pre">cl::Platform::get</span></code> OpenCL API. This call returns the available platforms in the system.</p>
<div class="highlight-Cpp notranslate"><div class="highlight"><pre><span></span><span class="n">cl</span><span class="o">::</span><span class="n">Platform</span><span class="o">::</span><span class="n">get</span><span class="p">(</span><span class="o">&amp;</span><span class="n">platforms</span><span class="p">)</span>
</pre></div>
</div>
<p>After retrieving the available platform, the host will verify the platform for a particular vendor. Because each platform contains a vendors’ installation, a system can have a mix of platforms. The <code class="docutils literal notranslate"><span class="pre">cl::platform.getInfo</span></code> API call will return the specific information about the available OpenCL platform. In this host code, you will retrieve the platform vendor information to verify it with the user input, <code class="docutils literal notranslate"><span class="pre">XILINX</span></code>.</p>
<div class="highlight-Cpp notranslate"><div class="highlight"><pre><span></span> <span class="n">platform</span><span class="p">.</span><span class="n">getInfo</span><span class="o">&lt;</span><span class="n">CL_PLATFORM_NAME</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">err</span><span class="p">)</span>
</pre></div>
</div>
<p>Now the host needs to select a specific device from the respective platform. This is done using the <code class="docutils literal notranslate"><span class="pre">cl::platform::getDevices</span></code> API.</p>
<div class="highlight-Cpp notranslate"><div class="highlight"><pre><span></span><span class="n">platform</span><span class="p">.</span><span class="n">getDevices</span><span class="p">(</span><span class="n">CL_DEVICE_TYPE_ACCELERATOR</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">devices</span><span class="p">)</span>
</pre></div>
</div>
<blockquote>
<div><p><strong>NOTE:</strong> In the current C++ code, the above operations are combined and kept inside a user-defined <code class="docutils literal notranslate"><span class="pre">get_devices(&quot;Xilinx&quot;)</span></code> function defined in the <code class="docutils literal notranslate"><span class="pre">host.hpp</span></code> file.</p>
<div class="highlight-Cpp notranslate"><div class="highlight"><pre><span></span><span class="n">get_devices</span><span class="p">(</span><span class="s">&quot;Xilinx&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>After you select the platform and the device, you need to create a context. The context is used by the runtime to manage objects, such as command-queues and kernel objects. The context is created using the <code class="docutils literal notranslate"><span class="pre">cl::Context</span></code> OpenCL API.</p>
<div class="highlight-Cpp notranslate"><div class="highlight"><pre><span></span><span class="n">cl</span><span class="o">::</span><span class="n">Context</span> <span class="n">context</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">err</span><span class="p">))</span>
</pre></div>
</div>
</li>
<li><p>After creating a context, you create a command-queue. The application will place commands in this queue for actions like transferring data, executing kernels and synchronizing. These commands are then scheduled on the devices within the context. The command queue is created using the <code class="docutils literal notranslate"><span class="pre">cl::CommandQueue</span></code> OpenCL API.</p>
<div class="highlight-Cpp notranslate"><div class="highlight"><pre><span></span><span class="n">cl</span><span class="o">::</span><span class="n">CommandQueue</span> <span class="n">q</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">CL_QUEUE_PROFILING_ENABLE</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">err</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Next, you need to create a program object. The program object is created from the pre-compiled FPGA binary file (<code class="docutils literal notranslate"><span class="pre">xclbin</span></code>). It contains the collection of user-defined kernel functions and is programed onto the FPGA.</p>
<blockquote>
<div><p><strong>TIP:</strong> The <code class="docutils literal notranslate"><span class="pre">xclbin</span></code> is the compiled kernel binary created, as explained in <a class="reference internal" href="../Pathway3/BuildingAnApplication.html"><span class="doc">Building an Application</span></a>.</p>
</div></blockquote>
<p>First, the application needs to read the contents of <code class="docutils literal notranslate"><span class="pre">xclbin</span></code> file. In this tutorial, you will use a user-defined function, <code class="docutils literal notranslate"><span class="pre">read_binary_file</span></code>, to achieve this. This function returns a pointer to the contents of <code class="docutils literal notranslate"><span class="pre">xclbin</span></code> file.</p>
<div class="highlight-Cpp notranslate"><div class="highlight"><pre><span></span><span class="n">fileBuf</span> <span class="o">=</span> <span class="n">read_binary_file</span><span class="p">(</span><span class="n">binaryFile</span><span class="p">,</span> <span class="n">fileBufSize</span><span class="p">)</span>
</pre></div>
</div>
<p>Then, create a <code class="docutils literal notranslate"><span class="pre">cl::Program::Binaries</span></code> object to store the contents of the <code class="docutils literal notranslate"><span class="pre">xclbin</span></code> binary file.</p>
<div class="highlight-Cpp notranslate"><div class="highlight"><pre><span></span><span class="n">cl</span><span class="o">::</span><span class="n">Program</span><span class="o">::</span><span class="n">Binaries</span> <span class="n">bins</span><span class="p">{{</span><span class="n">fileBuf</span><span class="p">,</span> <span class="n">fileBufSize</span><span class="p">}}</span>
</pre></div>
</div>
<p>Lastly, create the program object and initialize it with the contents of <code class="docutils literal notranslate"><span class="pre">xclbin</span></code> binary stored in the bins variable. To do this, use the <code class="docutils literal notranslate"><span class="pre">cl::Program</span> <span class="pre">program</span></code> API.</p>
<div class="highlight-Cpp notranslate"><div class="highlight"><pre><span></span><span class="n">cl</span><span class="o">::</span><span class="n">Program</span> <span class="n">program</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">devices</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">err</span><span class="p">)</span>
</pre></div>
</div>
<p>This step programs the FPGA with the binary loaded in the bins variable. If successful, this function will return <code class="docutils literal notranslate"><span class="pre">CL_SUCCESS</span></code>; make sure to check the return code.</p>
</li>
<li><p>Next, you must create kernel objects. Kernel objects are handles which the software application will use to pass arguments to the actual hardware kernels and execute them. Kernel objects are created using the <code class="docutils literal notranslate"><span class="pre">cl::Kernel</span></code> API.</p>
<div class="highlight-Cpp notranslate"><div class="highlight"><pre><span></span><span class="n">cl</span><span class="o">::</span><span class="n">Kernel</span> <span class="n">krnl_vector_add</span><span class="p">(</span><span class="n">program</span><span class="p">,</span><span class="s">&quot;vadd&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">err</span><span class="p">)</span>
</pre></div>
</div>
<blockquote>
<div><p><strong>NOTE</strong>: The mentioned operations are common to most applications and can be reused.</p>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="executing-the-kernel">
<h2>Executing the Kernel<a class="headerlink" href="#executing-the-kernel" title="Permalink to this headline">¶</a></h2>
<p>Now that you set up the hardware, the host application is ready to issue commands to the device and interact with the kernel. These commands include:</p>
<ul class="simple">
<li><p>Buffer transfer to/from the FPGA</p></li>
<li><p>Setting up the kernel arguments</p></li>
<li><p>Kernel execution on the FPGA</p></li>
<li><p>Event Synchronization</p></li>
</ul>
<p>As you work through this section, refer to step 2 in the <code class="docutils literal notranslate"><span class="pre">host.cpp</span></code> file.</p>
<ol>
<li><p>First, you must create buffers in the global memory. Buffers are used to transfer data back and forth between the host and the device. Kernels will read, process, and write back data in these buffers. Buffer objects are created using the <code class="docutils literal notranslate"><span class="pre">cl::Buffer</span></code> API.</p>
<div class="highlight-Cpp notranslate"><div class="highlight"><pre><span></span><span class="n">cl</span><span class="o">::</span><span class="n">Buffer</span> <span class="n">buffer_in1</span> <span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="n">CL_MEM_USE_HOST_PTR</span> <span class="o">|</span> <span class="n">CL_MEM_READ_ONLY</span><span class="p">,</span> <span class="n">vector_size_bytes</span><span class="p">,</span> <span class="n">source_in1</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="o">&amp;</span><span class="n">err</span><span class="p">)</span>
</pre></div>
</div>
<p>You will create the following buffers:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">buffer_in1</span></code>: Stores source_in1</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">buffer_in2</span></code>: Stores source_in2</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">buffer_output</span></code>: Stores results (source_hw_results)</p></li>
</ul>
</li>
<li><p>Before executing the kernel, you need to set each of its arguments. Kernel arguments are either scalar values or buffer objects. Kernel arguments are set using the <code class="docutils literal notranslate"><span class="pre">cl::Kernel::setArg</span></code> API.</p>
<div class="highlight-Cpp notranslate"><div class="highlight"><pre><span></span><span class="n">krnl_vector_add</span><span class="p">.</span><span class="n">setArg</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">buffer_in1</span><span class="p">)</span>
</pre></div>
</div>
<p>This will pass to the kernel the pointers where the input data is located, where the output should be stored, and what is the size of each buffer. The following arguments are set:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">in1</span></code> (input): Input Vector1</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">in2</span></code> (input): Input Vector2</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">out</span></code> (output): Output Vector</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">size</span></code> (input): Size of Vector in Integer</p></li>
</ul>
</li>
<li><p>Next, request the transfer of input data from the host memory to the device memory (global memory) using the <code class="docutils literal notranslate"><span class="pre">cl::CommandQueue::enqueueMigrateMemObjects</span></code> API.</p>
<div class="highlight-Cpp notranslate"><div class="highlight"><pre><span></span><span class="n">q</span><span class="p">.</span><span class="n">enqueueMigrateMemObjects</span><span class="p">({</span><span class="n">buffer_in1</span><span class="p">,</span> <span class="n">buffer_in2</span><span class="p">},</span><span class="mi">0</span><span class="cm">/* 0 means from host*/</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Now, request the execution of the kernel using the <code class="docutils literal notranslate"><span class="pre">cl::CommandQueue::enqueueTask</span></code> API.</p>
<div class="highlight-Cpp notranslate"><div class="highlight"><pre><span></span><span class="n">q</span><span class="p">.</span><span class="n">enqueueTask</span><span class="p">(</span><span class="n">krnl_vector_add</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Then, request the transfer of the output results from the device global memory to the host memory. To do this, use the <code class="docutils literal notranslate"><span class="pre">cl::CommandQueue::enqueueMigrateMemoryObjects</span></code> API.</p>
<div class="highlight-Cpp notranslate"><div class="highlight"><pre><span></span><span class="n">q</span><span class="p">.</span><span class="n">enqueueMigrateMemObjects</span><span class="p">({</span><span class="n">buffer_output</span><span class="p">},</span><span class="n">CL_MIGRATE_MEM_OBJECT_HOST</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Finally, wait for all the requests placed in the command queue to complete.</p>
<div class="highlight-Cpp notranslate"><div class="highlight"><pre><span></span><span class="n">q</span><span class="p">.</span><span class="n">finish</span><span class="p">();</span>
</pre></div>
</div>
<p>It is important to understand that an “enqueue” API call does not actually execute the specified command; it only requests its execution. When an “enqueue” function returns, it does not mean that that the command has actually been executed. It is up to the runtime to schedule the execution of the command. Therefore, the application must use synchronization methods to know when commands have completed.</p>
</li>
</ol>
</div>
<div class="section" id="releasing-the-fpga-after-the-application-returns">
<h2>Releasing the FPGA After the Application Returns<a class="headerlink" href="#releasing-the-fpga-after-the-application-returns" title="Permalink to this headline">¶</a></h2>
<p>The last step in building the host application is releasing the objects. As you work through this section, refer to step 3 in the <code class="docutils literal notranslate"><span class="pre">host.cpp</span></code> file. The C++ wrapper releases the objects automatically once the object passes out of scope.</p>
</div>
<div class="section" id="next-step">
<h2>Next Step<a class="headerlink" href="#next-step" title="Permalink to this headline">¶</a></h2>
<p>The next step in this tutorial is to <a class="reference external" href="./my-first-program/building_application">compile, link, and run the application and the kernel</a>.
</br></p>
<hr/>
<p align="center" class="sphinxhide"><b><a href="/docs/vitis-getting-started/README.md">Return to Getting Started Pathway</a> — <a href="/docs/my-first-program/README.md">Return to Start of Tutorial</a></b></p><p align="center" class="sphinxhide"><sup>Copyright&copy; 2020 Xilinx</sup></p></div>
</div>


           </div>
           
          </div>
          <footer>
<!-- Atalwar: Moved the footer code to layout.html to resolve conflict with the Xilinx template -->
</footer>

        </div>
      </div>
	  
	  
	  <!-- Sphinx Page Footer block -->
  

  <hr/>

  <div role="contentinfo" class="copyright">
    <p class="footerinfo">
      <span class="lastupdated">
        Last updated on July 23, 2020.
      </span>

    </p>
  </div>	  
      </div>
    </section>


  




  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

   <script type="text/javascript">
    jQuery(function() { Search.loadIndex("searchindex.js"); });
  </script>

  <script type="text/javascript" id="searchindexloader"></script>     	    
	    
	    
  
  
    
  
  

  
  <!--  Xilinx template footer block -->
							</div>
						</div>
					</div>
				</div>
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="footer parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
								<noindex>
									<footer>
										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">
													<div class="row">
														<div class="footerSocial parbase">
															<div class="col-md-push-6 col-lg-push-6 col-md-6 col-lg-6">
																<ul class="list-inline pull-right social-menu">
																	<li>
																		<a href="https://www.linkedin.com/company/xilinx">
																		<span class="linkedin icon"></span>
																		<span class="sr-only">Connect on LinkedIn</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.twitter.com/XilinxInc">
																		<span class="twitter icon"></span>
																		<span class="sr-only">Follow us on Twitter</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.facebook.com/XilinxInc">
																		<span class="facebook icon"></span>
																		<span class="sr-only">Connect on Facebook</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.youtube.com/XilinxInc">
																		<span class="youtube icon"></span>
																		<span class="sr-only">Watch us on YouTube</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.xilinx.com/registration/subscriber-signup.html">
																		<span class="newsletter icon"></span>
																		<span class="sr-only">Subscribe to Newsletter</span>
																		</a>
																	</li>
																</ul>
															</div>
														</div>
														<div class="col-md-pull-6 col-lg-pull-6 col-md-6 col-lg-6">
															<span class="copyright">
                                  
                                  &copy; 2020, Xilinx
                              </span>
															<ul class="list-inline sub-menu">
																<li>
																	<a href="https://www.xilinx.com/about/privacy-policy.html">Privacy</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/legal.html">Legal</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/contact.html">Contact</a>
																</li>
															</ul>
														</div>
													</div>
												</div>
											</div>
										</div>
									</footer>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="quicklinks parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<noindex>
						<span class="quickLinks">
							<ul>
								<li>
									<a href="#top" class="btn backToTop">
									<span class="fas fa-angle-up" aria-hidden="true"></span>
									</a>
								</li>
							</ul>
						</span>
					</noindex>
				</div>
			</div>
		</div>
		<script>window.CQ = window.CQ || {}</script>
		<script src="https://static.cloud.coveo.com/searchui/v2.4382/js/CoveoJsSearch.Lazy.min.js"></script>
		<script>
			var underscoreSetup = function () {
			  _.templateSettings.interpolate = /\{\{=([^-][\S\s]+?)\}\}/g;
			  _.templateSettings.evaluate = /\{\{([^-=][\S\s]+?)\}\}/g;
			  _.templateSettings.escape = /\{\{-([^=][\S\s]+?)\}\}/g;
			}
			
			underscoreSetup();
		</script>
	</body>
</html>